<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>어라운드 달콤창고</title>
    <style>
        #description .images {
            text-align: center;
        }
        #description .images img {
            width: 60%;
            min-width: 300px;
            margin: auto;
        }
        #map {
            height: 320px;
        }
        @media (max-width:768px){
            #map {
                height: 280px;
            }
        }
        @media (max-width:450px){
            #map {
                height: 230px;
            }
        }
    </style>
</head>
<body style="max-width:800px;padding:0;margin:0;">
<h1 style="padding:10px 0px 0px 0px;margin:0px;">어라운드 달콤창고</h1><span style="font-size:13px;color:#666;">등록문의는 jeonghuns99@hanmail.net 으로 주세요. (위치,기간 필수! 사진은 옵션!)</span>
<div style="margin:10px 0;width:100%;float:left;padding:0;">
    <form id="searchForm">
        <input type="text" id="search" style="height:30px;width:95%;float:left;"><button type="submit" style="float:left;width:100px;height:25px;margin-top:5px;margin-left:-110px;">검색</button>
    </form>
</div>
<div id="map" style="width:100%;"></div>
<div id="description" style="border-top:1px solid #ddd;margin-top:30px;padding-top:10px;display:none;width:100%;">
    <h2 class="title">강남역</h2>
    <p class="duration">기간 : 2014-05-06 ~ 2015-05-06</p>
    <p class="keyword"></p>
    <p class="text">좋네요ㅎㅎ</p>
    <div class="images" style="width:100%;"></div>
</div>

<script type="text/javascript" src="//apis.daum.net/maps/maps3.js?apikey=8f136b27e2e8cb047b70b7c4ac91b5d1&libraries=services"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.10.2/moment.min.js"></script>
<script type="text/javascript" src="https://code.jquery.com/jquery-1.11.3.min.js"></script>


<script>
    var latlng = function(l) {
        var v = l.split(',');
        return new daum.maps.LatLng(v[0], v[1]);
    };
    var items = [
        {
            name: '강남역',
            latlng: '37.498319594791155,127.02843009341994',
            description: '강남역 달콤창고입니다. 위치는 1번출구에서 개찰구 지나서 화장실 옆 사물함입니다.',
            keyword: '강남역 달콤창고',
            startDate: '2015-03-01',
            endDate: '2015-05-27',
            images: [
                    'https://scontent.xx.fbcdn.net/hphotos-xta1/t31.0-8/1496506_1530950983834943_1838317777655519330_o.jpg',
                    'https://fbcdn-sphotos-c-a.akamaihd.net/hphotos-ak-xfp1/v/t1.0-9/10943637_1405545413073617_276940928419772991_n.jpg?oh=d9fa10d39fed663c19122e9c7556e0ac&oe=55DAA527&__gda__=1440846766_ef73ebb8bca83923e12c042eb9e41efe',
                    'https://fbcdn-sphotos-h-a.akamaihd.net/hphotos-ak-xfp1/v/t1.0-9/10945631_348076825393644_1528834950412882483_n.jpg?oh=de5d78e9581ccf40c9815cad2f37470d&oe=55C68072&__gda__=1443740155_181b50448eab0ca0533d25985adeb720']
        },
        {
            name: '합정',
            latlng: '37.54905407655182,126.91385980610694',
            description: '5/6/7번 출구쪽 사물함입니다.',
            keyword: '합정역 달콤창고',
            startDate: '2015-04-21',
            endDate: '2015-05-21',
            images: [
                    './images/hap1.jpg',
                    './images/hap2.jpg',
                    './images/hap3.jpg'
            ]
        },
        {
            name: '일산 라페스타',
            latlng: '37.66119043776487,126.7690997590325',
            description: '라페스타 C동 롯데시네마 건물 1층 엘레베이터 앞 물품보관함',
            keyword: '#일산탈콤상자 또는 #라페스타',
            startDate: '2015-05-09',
            endDate: '2015-06-01',
            images: [
                './images/ilsan1.jpg',
                './images/ilsan2.jpg',
                './images/ilsan3.jpg'
            ]
        },
        {
            name: '종로3가',
            latlng: '37.57056501065246,126.99225737788247',
            description: '종로3가역 물품보관함',
            keyword: '종로3가 달콤창고',
            startDate: '2015-05-08',
            endDate: '2015-05-08',
            images: [
                './images/jong3.jpg'
            ]
        },
        {
            name: '동아대학교 승학캠',
            latlng: '35.11641839470421,128.96722866921198',
            description: '동아대학교 승학캠 공대2호관 p2102옆 사물함',
            keyword: '동아대학교 달콤창고',
            startDate: '2015-05-08',
            endDate: '2015-06-01',
            images: [
                './images/donga-sh.jpg'
            ]
        },
        {
            name: '안암역',
            latlng: '37.58636503086245,127.02943723904436',
            description: '안암역 사물함입니다.',
            keyword: '안암역 달콤창고',
            startDate: '2015-05-08',
            endDate: '2015-06-01',
            images: [
                './images/anam.jpg'
            ]
        },
        {
            name: '신림역',
            latlng: '37.48442661083869,126.92974070299358',
            description: '신림역 1번출구 포도몰 입구앞 사물함입니다.',
            keyword: '신림역 달콤창고',
            startDate: '2015-05-08',
            endDate: '2015-06-01',
            images: [
                './images/sinlim1.jpg'
            ]
        },
        {
            name: '광주 금남로4가역',
            latlng: '35.15073895531338,126.9145471768349',
            description: '광주 금남로4가 cu옆 사물함',
            keyword: '금남로4가역 달콤창고',
            startDate: '2015-05-07',
            endDate: '2015-05-14',
            images: [
                './images/kwangju1.jpg',
                './images/kwangju2.jpg'
            ]
        },
        {
            name: '노원역',
            latlng: '37.65639440291111,127.06346278261645',
            description: '4호선 라인쪽 물품보관소',
            keyword: '노원역 달콤창고',
            startDate: '2015-05-07',
            endDate: '2015-05-14',
            images: [
                './images/nowon1.jpg',
                './images/nowon2.jpg'
            ]
        },
        {
            name: '수원역',
            latlng: '37.266255245587345,127.00006764348147',
            description: '수원역 엘리베이터 만드는곳 쪽 보관소',
            keyword: '수원역 달콤창고',
            startDate: '2015-05-07',
            endDate: '2015-05-07',
            images: [
                './images/nowon1.jpg',
                './images/nowon2.jpg'
            ]
        },
        {
            name: '용인대학교 보건복지대학',
            latlng: '37.22841128593169,127.16662958557465',
            description: '용인대학교 보건복지 대학 6층 사물함',
            keyword: '용인대학교 달콤창고',
            startDate: '2015-05-07',
            endDate: '2015-05-21',
            images: [
                './images/yongin.jpg'
            ]
        },
        {
            name: '서울역',
            latlng: '37.55315481179077,126.97252235045936',
            description: '서울역4호선 라인',
            keyword: '서울역 달콤창고',
            startDate: '2015-05-07',
            endDate: '2015-05-07',
            images: [
                './images/seoul1.jpg'
            ]
        },
        {
            name: '대전 중앙로',
            latlng: '36.32843104531424,127.42531012568494',
            description: '대전 중앙로4번 출구쪽',
            keyword: '대전 달콤창고',
            startDate: '2015-01-12',
            endDate: '2015-02-07',
            images: [

            ]
        },
        {
            name: '울산대',
            latlng: '35.543787099524884,129.25607003500008',
            description: '울산대 구아산 휴게실',
            keyword: '울산대 달콤창고',
            startDate: '2015-03-13',
            endDate: '2015-06-01',
            images: [

            ]
        }


    ];
</script>
<script>
    var mapContainer = document.getElementById('map'), // 지도를 표시할 div
            mapOption = {
                center: new daum.maps.LatLng(35.750701, 126.570667), // 지도의 중심좌표
                level: 20 // 지도의 확대 레벨
            };

    var map = new daum.maps.Map(mapContainer, mapOption); // 지도를 생성합니다

    // 마커 이미지의 이미지 크기 입니다
    var imageSize = new daum.maps.Size(32, 32);

    // 마커 이미지를 생성합니다
    var activeMarkerImage = new daum.maps.MarkerImage("./images/icon-active.png?1", imageSize);
    var inactiveMarkerImage = new daum.maps.MarkerImage("./images/icon-inactive.png?1", imageSize);

    var activeItems = [];
    var inactiveItems = [];
    for (var i = 0; i < items.length; i ++) {
        if (moment(items[i].endDate).isBefore(moment().format('YYYY-MM-DD'))) {
            inactiveItems.push(items[i]);
        } else {
            activeItems.push(items[i]);
        }
    }

    items = $.merge(inactiveItems, activeItems);

    for (var i = 0; i < items.length; i ++) {
        // 마커를 생성합니다
        var marker = new daum.maps.Marker({
            map: map, // 마커를 표시할 지도
            position: latlng(items[i].latlng), // 마커를 표시할 위치
            title : items[i].title, // 마커의 타이틀, 마커에 마우스를 올리면 타이틀이 표시됩니다
            image : (moment(items[i].endDate).isBefore(moment().format('YYYY-MM-DD'))) ? inactiveMarkerImage : activeMarkerImage, // 마커 이미지
            clickable: true
        });

        (function(marker, idx) {
            daum.maps.event.addListener(marker, 'click', function() {
                selectItem(idx);
            });
        })(marker, i)

    }

    daum.maps.event.addListener(map, 'click', function(mouseEvent) {

        // 클릭한 위도, 경도 정보를 가져옵니다
        var latlng = mouseEvent.latLng;

        var message = latlng.getLat() + ',' + latlng.getLng();
        if (console && console.log && typeof console.log == "function") {
            console.log(message);
        }
    });

    // 장소 검색 객체를 생성합니다
    var ps = new daum.maps.services.Places();

    // 키워드 검색 완료 시 호출되는 콜백함수 입니다
    function placesSearchCB (status, data, pagination) {
        if (status === daum.maps.services.Status.OK) {

            // 검색된 장소 위치를 기준으로 지도 범위를 재설정하기위해
            // LatLngBounds 객체에 좌표를 추가합니다
            var bounds = new daum.maps.LatLngBounds();

            for (var i=0; i<data.places.length; i++) {
                bounds.extend(new daum.maps.LatLng(data.places[i].latitude, data.places[i].longitude));
            }

            // 검색된 장소 위치를 기준으로 지도 범위를 재설정합니다
            map.setBounds(bounds);
        }
    }

    $('#searchForm').submit(function(e) {
        e.preventDefault();
        if ($('#search').val()) {
            ps.keywordSearch($('#search').val(), placesSearchCB);
        }
    });

    var selectItem = function(idx) {
        var item = items[idx];
        $('#description .title').text(item.name);
        $('#description .text').text(item.description);
        $('#description .duration').text('기간 : ' + item.startDate + '~' + item.endDate);
        $('#description .keyword').text('어라운드 검색 키워드 : ' + item.keyword);
        $('#description .images').empty();
        for (var i = 0; item.images && i < item.images.length; i++) {
            $('#description .images').append($('<img>', {src: item.images[i]}));
        }
        $('#description').show();
    };
</script>

</body>
</html>
