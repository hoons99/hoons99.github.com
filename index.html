<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>어라운드 달콤창고</title>
    <style>
        #description .images {
            text-align: center;
        }
        #description .images img {
            width: 60%;
            min-width: 300px;
            margin: auto;
        }
    </style>
</head>
<body style="max-width:800px;">
<h1 style="padding:10px 0px 0px 0px;margin:0px;">어라운드 달콤창고</h1><span style="font-size:13px;color:#666;">등록문의는 jeonghuns99@hanmail.net 으로 주세요. (위치,기간 필수! 사진은 옵션!)</span>
<div style="margin:10px 0;width:100%;float:left;">
    <form id="searchForm">
        <input type="text" id="search" style="height:30px;width:100%;float:left;"><button type="submit" style="float:left;width:100px;height:25px;margin-top:5px;margin-left:-110px;">검색</button>
    </form>
</div>
<div id="map" style="width:100%;height:350px;"></div>
<div id="description" style="border-top:1px solid #ddd;margin-top:30px;padding-top:10px;display:none;width:100%;">
    <h2 class="title">강남역</h2>
    <span class="duration">기간 : 2014-05-06 ~ 2015-05-06</span>
    <p class="text">좋네요ㅎㅎ</p>
    <div class="images" style="width:100%;"></div>
</div>

<script type="text/javascript" src="//apis.daum.net/maps/maps3.js?apikey=8f136b27e2e8cb047b70b7c4ac91b5d1&libraries=services"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.10.2/moment.min.js"></script>
<script type="text/javascript" src="https://code.jquery.com/jquery-1.11.3.min.js"></script>


<script>
    var latlng = function(l) {
        var v = l.split(',');
        return new daum.maps.LatLng(v[0], v[1]);
    };
    var items = [
        {
            name: '강남역',
            latlng: '37.498319594791155,127.02843009341994',
            description: '강남역 창고입니다.',
            startDate: '2015-03-01',
            endDate: '2015-05-27',
            images: ['https://fbcdn-sphotos-f-a.akamaihd.net/hphotos-ak-xpt1/v/t1.0-9/11130150_935342999863908_6232451359344639751_n.jpg?oh=6774be8d496b73ed8ea4e04c0b9653ed&oe=55BFBE3E&__gda__=1440192570_3dbfb7ef4ffe08cde587bb22892e2a35',
            'https://fbcdn-sphotos-a-a.akamaihd.net/hphotos-ak-xpa1/v/t1.0-9/11174911_934518279946380_7877880034778516342_n.jpg?oh=a3d9bec7e0925c351cff4c9d69ce3101&oe=55C62156&__gda__=1439946478_f9c59e57573cdd8769040d17562d63e9']
        },
        {
            name: '노원역',
            latlng: '37.65652045487749,127.0636215471123',
            description: '노원역 달콤창고',
            startDate: '2015-05-01',
            endDate: '2015-05-02',
            images: [
                    'https://scontent.xx.fbcdn.net/hphotos-xpa1/v/t1.0-9/11169877_935344139863794_3912076722771925610_n.jpg?oh=2013d6cf40c13c46a28c2bc45193c4dd&oe=55DC1C72'
            ]
        }
    ];
</script>
<script>
    var mapContainer = document.getElementById('map'), // 지도를 표시할 div
            mapOption = {
                center: new daum.maps.LatLng(36.150701, 126.570667), // 지도의 중심좌표
                level: 20 // 지도의 확대 레벨
            };

    var map = new daum.maps.Map(mapContainer, mapOption); // 지도를 생성합니다

    // 마커 이미지의 이미지 크기 입니다
    var imageSize = new daum.maps.Size(32, 32);

    // 마커 이미지를 생성합니다
    var activeMarkerImage = new daum.maps.MarkerImage("./images/icon-active.png", imageSize);
    var inactiveMarkerImage = new daum.maps.MarkerImage("./images/icon-inactive.png", imageSize);

    for (var i = 0; i < items.length; i ++) {
        // 마커를 생성합니다
        var marker = new daum.maps.Marker({
            map: map, // 마커를 표시할 지도
            position: latlng(items[i].latlng), // 마커를 표시할 위치
            title : items[i].title, // 마커의 타이틀, 마커에 마우스를 올리면 타이틀이 표시됩니다
            image : (moment(items[i].endDate).isBefore(moment().format('YYYY-MM-DD'))) ? inactiveMarkerImage : activeMarkerImage, // 마커 이미지
            clickable: true
        });

        (function(marker, idx) {
            daum.maps.event.addListener(marker, 'click', function() {
                selectItem(idx);
            });
        })(marker, i)

    }

    daum.maps.event.addListener(map, 'click', function(mouseEvent) {

        // 클릭한 위도, 경도 정보를 가져옵니다
        var latlng = mouseEvent.latLng;

        var message = latlng.getLat() + ',' + latlng.getLng();
        if (console && console.log && typeof console.log == "function") {
            console.log(message);
        }
    });

    // 장소 검색 객체를 생성합니다
    var ps = new daum.maps.services.Places();

    // 키워드 검색 완료 시 호출되는 콜백함수 입니다
    function placesSearchCB (status, data, pagination) {
        if (status === daum.maps.services.Status.OK) {

            // 검색된 장소 위치를 기준으로 지도 범위를 재설정하기위해
            // LatLngBounds 객체에 좌표를 추가합니다
            var bounds = new daum.maps.LatLngBounds();

            for (var i=0; i<data.places.length; i++) {
                bounds.extend(new daum.maps.LatLng(data.places[i].latitude, data.places[i].longitude));
            }

            // 검색된 장소 위치를 기준으로 지도 범위를 재설정합니다
            map.setBounds(bounds);
        }
    }

    $('#searchForm').submit(function(e) {
        e.preventDefault();
        if ($('#search').val()) {
            ps.keywordSearch($('#search').val(), placesSearchCB);
        }
    });

    var selectItem = function(idx) {
        var item = items[idx];
        $('#description .title').text(item.name);
        $('#description .text').text(item.description);
        $('#description .duration').text('기간 : ' + item.startDate + '~' + item.endDate);
        $('#description .images').empty();
        for (var i = 0; item.images && i < item.images.length; i++) {
            $('#description .images').append($('<img>', {src: item.images[i]}));
        }
        $('#description').show();
        map.setLevel(5);
        map.panTo(latlng(item.latlng));
    };
</script>

</body>
</html>
